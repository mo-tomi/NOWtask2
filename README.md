# NOWtask2

## プロジェクト概要
「今日やること」を1本のタイムラインに並べて見える、個人利用向けのタスク管理アプリケーション。localStorageを使用してデータを永続化し、シンプルで使いやすいUIを提供します。

### 主な特徴
- スマホ・タブレット・パソコン対応
- ログイン不要（個人専用）
- オフライン非対応（インターネット接続前提）
- 手動データエクスポート・インポート機能

## 開発方針

### テスト駆動開発（TDD）
- **Red-Green-Refactor** サイクルを厳守
- まず失敗するテストを書く（Red）
- テストを通す最小限のコードを書く（Green）
- コードをリファクタリングして改善する（Refactor）

### テスト戦略：Kent C. Dodds の Testing Trophy
```
    🏆
   E2E
  -----
 Integration  ← メインの戦場
  -----
   Unit
  -----
  Static
```

1. **静的解析（Static Analysis）** - 基盤
   - ESLint（コード品質）
   - Prettier（コードフォーマット）
   - TypeScript（型チェック）※可能であれば

2. **単体テスト（Unit Tests）**
   - 独立したビジネスロジック
   - 純粋な関数・モジュール

3. **統合テスト（Integration Tests）** - 最重要
   - 複数モジュールの連携
   - ユーザー操作から結果までの一連の流れ

4. **E2Eテスト（End-to-End Tests）**
   - 重要なユーザーフローのみ
   - 数を絞って実行コストを抑制

## 技術スタック
- **フロントエンド**: HTML, CSS, JavaScript（ES6+）
- **データストレージ**: localStorage
- **テスト**: Jest（想定）

## ファイル構成（最小限の3ファイル）
```
NOWtask2/
├── index.html      # HTMLとCSSを含むUI
├── app.js          # メインロジック（TaskRepository + TaskApp）
└── app.test.js     # すべてのテスト
```

### アーキテクチャ
```
index.html (UI層)
    ↓
app.js (ビジネスロジック + データ永続化)
    ↓
localStorage (データストレージ)
```

## 開発の進め方
1. 要件定義の確認
2. 最初の失敗するテストを作成
3. テストを通す最小限のコードを実装
4. リファクタリングで品質向上
5. 次の機能へ（1に戻る）

## 設計方針の簡素化

### レーン計算アルゴリズム
複雑な最適化は行わず、「左から順番に空いている場所を探す」シンプルな方式を採用：

```
ルール：
1. 新しいタスクは一番左のレーン（1列目）に置こうとする
2. もし1列目に重なるタスクがあったら、2列目に置く
3. 2列目も重なったら、3列目に置く
4. これを繰り返す
```

### パフォーマンス目標
- 速度の数値目標は設定しない
- まずは動くものを作ることを優先
- 必要に応じて後から最適化

### 実装順序
1. **データ保存部分**：TaskRepositoryクラス（localStorage操作）
2. **レーン計算部分**：シンプルな「左から順番」アルゴリズム  
3. **画面操作部分**：UI操作とビジネスロジックの連携
4. **全体の流れ**：重要なユーザーフローのテスト

## 開発者
- レビュアー: t_wada
- テスト戦略: Kent C. Dodds の Testing Trophy

## Playwright E2E テストの実行方法

1. 依存関係をインストール（初回のみ）
   ```bash
   npm install --save-dev playwright
   # ブラウザバイナリの取得（選択式、All をインストール）
   npx playwright install
   ```

2. E2E フラグを付けてテスト実行
   - PowerShell (Windows)
     ```powershell
     $env:E2E=1; node app.test.js
     ```
   - macOS / Linux / Bash
     ```bash
     E2E=1 node app.test.js
     ```

`E2E=1` がセットされていない場合は、従来の Node ベース単体／統合テストのみが走ります。

---

**注意**: このプロジェクトは個人利用を想定しており、localStorageを使用したシンプルな構成です。 

## 使い方メモ: Quick Add 入力フォーマット

`sidebar` 上部の "クイック追加" に文字列を入力して Enter または [タスクを追加] ボタンをクリックするとタスクが即時作成されます。

| 入力例 | 意味 | 生成されるタスク |
| ------ | ---- | -------------- |
| `10:00-11:30 企画会議` | 10時開始、11時30分終了、タイトルは「企画会議」 | `{ startTime: "10:00", endTime: "11:30", title: "企画会議" }` |
| `9:00 朝会` | 9時開始、デフォルト 60 分間、タイトルは「朝会」 | `{ startTime: "09:00", endTime: "10:00" }` |
| `買い物` | 時間指定なし。開始・終了はデフォルト値（09:00-10:00） | `{ startTime: "09:00", endTime: "10:00" }` |

デフォルトの開始時刻・所要時間は `app.js` の `AppConfig` で変更できます。

---

## テスト実行

現在のテストランナーは **Vitest + jsdom** を使用しています。実行はシンプルです。

```bash
npm install
npm test    # または  npx vitest
```

プレイグラウンド E2E テストについては従来通り `E2E=1` フラグで Playwright を起動してください。 

### クイックスタート (pnpm)

```bash
# 依存関係をインストール
pnpm install

# 開発サーバーを起動 (http://localhost:5173)
pnpm dev

# ビルド済みをプレビュー
pnpm start

# 単体・統合テスト
pnpm test
``` 