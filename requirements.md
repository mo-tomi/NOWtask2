# ✅ NowTask 要件定義書（やさしい日本語版・完成版）

> **目的**
> 「今日やること」を 1 本のたて線（タイムライン）に並べてパッと見えるようにする、**自分専用のタスク管理アプリ**を作ります。インターネットに接続している状態で使うことを前提にし、ログインもクラウドもありません。

---

## 1. 使い方の前提

| 項目       | 決定内容                                               |
| -------- | -------------------------------------------------- |
| 対応端末     | スマホ／タブレット／パソコン すべて                                 |
| インストール   | ブラウザで開くだけ（アプリの追加は不要）                               |
| ログイン     | なし（ID・パスワード不要）                                     |
| 保存先      | 端末内ブラウザの「ローカル保存」。あとで**手動エクスポート／インポート**はできる仕組みを用意する |
| オフライン動作  | インターネットが切れると動かない（オフライン対応はしない）                      |
| 通知       | なし                                                 |
| アクセシビリティ | **Tabキーでの移動・Enterキーで決定**だけは使えるようにする（ショートカットは増やさない） |
| 初回リリース範囲 | この文書に書かれた機能をすべて入れる（将来拡張フェーズ 4～6 も含む）               |
| 公開範囲     | 開発者（あなた）だけが見る試作品                                   |

---

## 2. 機能まとめ（専門用語をなるべく避けて説明）

| 大きなカテゴリー    | できること                                                                                                                    | かんたん説明          |
| ----------- | ------------------------------------------------------------------------------------------------------------------------ | --------------- |
| ① タスク作成     | 1) 画面上部の入力欄ですぐ追加<br>2) 右側のくわしく入力する画面<br>3) タイムライン上で時間を押して追加<br>4) 「睡眠」「ごはん」などのテンプレート<br>5) 夜 22:00 〜 朝 8:00 など日にちをまたぐタスク | どこからでもサクッと登録できる |
| ② タスク編集     | 名前や時間をその場で書き換え・ドラッグして移動・カードの上下をつまんで長さ変更・**インライン編集**・優先度を3段階で切替え・右クリック（長押し）でメニュー | マウス／指で直感操作      |
| ③ タスク削除     | 1 件だけ削除・複数まとめて削除・終わったタスクを一気に消す                                                                                           | ごみ箱を空にする感覚      |
| ④ タスク完了     | チェックを入れると色が薄くなり線が引かれる                                                                                                    | 終わった感がわかる       |
| ⑤ タイムライン表示  | 同じ時間帯に重ならないよう自動で**横レーン**に並び替え                                                                                            | 見やすい            |
| ⑥ 日付スクロール   | 上下にスクロールすると前日・翌日のパネルを自動で読み込み／不要になったら消す                                                                                   | たくさんの日付でも軽い     |
| ⑦ URL共有     | 例 `...?date=2025-01-01` を開くとその日の画面にジャンプ                                                                                  | ブックマークできる       |
| ⑧ サイドバー     | ①今日のタスク数などの統計<br>②テンプレート一覧<br>③優先度フィルター<br>④「完了したタスクを全部消す」ボタン                                                            | 補助パネル           |
| ⑨ 見た目       | 明るいテーマのみ。うすいガラス風の背景、タスクカードは色帯で優先度がわかる。                                                                                   | おしゃれ＆シンプル       |
| ⑩ キーボード     | Tab移動・Enter確定のみ。ショートカット (N で新規など) は**入れない**                                                                              | 迷わない            |
| ⑪ データ構造     | 1 タスク = ID / 名前 / 開始 / 終了 / 優先度 / 日付 / 完了フラグ / レーン番号                                                                     | 最低限の情報だけ        |
| ⑫ バックアップ    | 「設定」→「データをダウンロード」で JSON ファイル保存、「読み込む」で復元                                                                                 | 機種変更時は手動        |
| ⑬ テスト       | **単体 8 ケース＋E2E 3 ケース実装済み**。主要操作を自動で確認                                           | 品質を守る           |
| ⑭ リピートタスク  | 毎日／平日／毎週◯曜日などを設定し、自動で同じタスクを生成                                                                                      | 習慣タスクを忘れない    |
| ⑮ インライン編集  | カードをクリックしてその場でタイトルを直接編集、Enterで確定・Escでキャンセル                                                                      | 編集がよりスムーズ      |
| ⑯ アンドゥ／リドゥ | 削除や完了トグル **＋ドラッグ／リサイズ／編集** をいつでも取り消し／やり直し                                       | ミス操作を防げる       |
| ⑰ タグ／ラベル   | タスクに自由入力タグを複数付け、サイドバーでフィルタ                                                                                     | 自由な分類ができる      |
| ⑱ 週ビュー・月ビュー | 7日/30日をまとめて横に並べて俯瞰表示、レーン計算は日単位で継続                                                                               | 長期計画が立てやすい     |
| ⑲ 統計グラフ    | 完了率推移や優先度別比率をグラフ(SVG/canvas)で表示                                                                                        | 進捗を視覚化できる      |

---

## 3. 画面構成（ざっくり）

```
┌──────────────────────────────────┐
│ ①ヘッダー：今日・前日・翌日ボタン ／ 時計 ──────────────│
├──────────────────────────────────┤
│ ②クイック追加バー  [ 宿題をする ____________________ ][＋]   │
├─────────────┬─────────────────────────┤
│ ③サイドバー      │ ④タイムライン（24時間縦長）          │
│   ・統計          │   ┌ 09:00 ───────────────┐      │
│   ・テンプレ       │   │ プレゼン資料作成          │      │
│   ・フィルター     │   ├───────────────┤      │
│   ・完了クリア     │   │ 夕食の準備 (優先度高)     │      │
│                    │   └─────────────────┘      │
└─────────────┴─────────────────────────┘
```

---

## 4. なぜ Tab と Enter を残すのか

* 目が見えにくい人は **キーボードだけ** で操作することがあります。
* Tab ←→ で入力欄を移動し、Enter で決定できれば最低限操作できます。
* 「たくさんのショートカット」は混乱のもとなので入れませんが、**Tab と Enter は"ふつうの操作"** として残します。

---

## 5. 今後やらない・あとでやる

| 今は **やらない** | **理由**           |
| ----------- | ---------------- |
| ダークモード      | **将来対応予定（優先度: 中）**                                   | デザインをシンプルに保つ |
| 通知・リマインダー   | 必要になったら考える       |
| オフライン (PWA) | まずはオンライン前提で完成させる |
| SNS共有・チーム機能 | 自分だけで使うので不要      |
| AI でタスク予測   | 今は時間をかけずに基本を作り切る |
| パフォーマンス目標   | まずは動くものを作ることを優先  |

> ※ もし「AI やチーム機能」を本当に最初から入れたい場合は、開発期間・作業量が大きく増えます。**まずは上の基本を完成させてから** 追加する方が安全です。

---

## 6. 用語メモ（難しい言葉の言い換え）

| 難しめの言葉             | ここではこう理解すれば OK                  |
| ------------------ | ------------------------------- |
| アルゴリズム             | タスクをだぶらず並べる**手順**               |
| Clean Architecture | コードを「計算」「保存」「画面」で**分けて整理**するやり方 |
| レスポンシブ             | 画面の幅に合わせて**自動で配置が変わる**          |
| Web Worker         | 重い計算を**裏でこっそりやる人**              |
| テストカバレッジ           | テストがコードを**どれだけ見ているか**の割合        |

---

## 7. レーン計算の簡素化

複雑な最適化は行わず、「左から順番に空いている場所を探す」シンプルな方式を採用：

### ルール
1. 新しいタスクは一番左のレーン（1列目）に置こうとする
2. もし1列目に重なるタスクがあったら、2列目に置く
3. 2列目も重なったら、3列目に置く
4. これを繰り返す

### 具体例
```
     レーン1   レーン2   レーン3
9:00  ┌────┐
      │宿題  │
10:00 │    │  ┌────┐
      └────┘  │掃除  │
11:00           │    │  ┌────┐
                └────┘  │買物  │
12:00                   └────┘
```

---

## 8. 完了の定義（Done のチェックリスト）

* [ ] 上記すべての機能が **マウス／タッチ／Tab＋Enter** で動く
* [ ] ページを再読込してもタスクが残っている
* [ ] JSON のエクスポート／インポートが動く
* [ ] 見た目が「ガラス風＋カード」のデザインになっている
* [ ] テストが全部通る
* [ ] レーン計算が「左から順番」ルールで動く

---

## 9. 開発の進め方

### 実装順序
1. **データ保存部分**：TaskRepositoryクラス（localStorage操作）
2. **レーン計算部分**：シンプルな「左から順番」アルゴリズム
3. **画面操作部分**：UI操作とビジネスロジックの連携
4. **全体の流れ**：重要なユーザーフローのテスト

### テスト戦略
- **統合テスト**を最重要視（Kent C. Dodds の Testing Trophy）
- 単体テストは純粋な関数・ビジネスロジックのみ
- E2Eテストは重要なユーザーフローのみ数を絞る 